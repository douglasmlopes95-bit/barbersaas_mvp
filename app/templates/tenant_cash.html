{% extends "base.html" %}

{% block title %}Caixa | Barbearia{% endblock %}

{% block content %}

<div class="header">
    <h1>Caixa <span>Financeiro</span></h1>
    <p style="color:#9a9a9a;">
        Controle de abertura, fechamento e movimentações do caixa
    </p>
</div>

<!-- ============================= -->
<!-- VOLTAR AO DASHBOARD -->
<!-- ============================= -->
<div style="margin-bottom:20px;">
    <a href="{{ url_for('tenant.dashboard') }}" class="btn btn-sm btn-gold">
        ← Voltar ao Dashboard
    </a>
</div>

<!-- ============================= -->
<!-- STATUS DO CAIXA -->
<!-- ============================= -->
<div class="cards">

    {% if caixa_aberto %}
        <div class="card">
            <h3>Status</h3>
            <p style="color:#2ecc71;">Caixa Aberto</p>
        </div>

        <div class="card">
            <h3>Abertura</h3>
            <p>{{ caixa_aberto.aberto_em.strftime("%d/%m/%Y %H:%M") }}</p>
        </div>

        <div class="card">
            <h3>Saldo Atual</h3>
            <p style="color:#f1c40f;">
                R$ {{ "%.2f"|format(saldo_atual) }}
            </p>
        </div>
    {% else %}
        <div class="card">
            <h3>Status</h3>
            <p style="color:#ff4d4d;">Caixa Fechado</p>
        </div>
    {% endif %}

</div>

<!-- ============================= -->
<!-- ABRIR CAIXA -->
<!-- ============================= -->
{% if not caixa_aberto %}
<div class="card" style="max-width:400px;">
    <h3>Abrir Caixa</h3>

    <form method="POST" action="{{ url_for('cash.open_cash') }}">
        <div class="form-group">
            <label>Saldo Inicial (R$)</label>
            <input type="number" step="0.01" name="saldo_inicial" value="0">
        </div>

        <button class="btn btn-gold">Abrir Caixa</button>
    </form>
</div>
{% endif %}

<!-- ============================= -->
<!-- FECHAR CAIXA -->
<!-- ============================= -->
{% if caixa_aberto %}
<div class="card" style="max-width:400px;">
    <h3>Fechar Caixa</h3>

    <form method="POST"
          action="{{ url_for('cash.close_cash') }}"
          onsubmit="return confirm('Deseja realmente fechar o caixa?');">
        <button class="btn btn-danger">Fechar Caixa</button>
    </form>
</div>
{% endif %}

<!-- ============================= -->
<!-- REGISTRAR MOVIMENTAÇÃO -->
<!-- ============================= -->
{% if caixa_aberto %}
<div class="card">
    <h3>Registrar Movimentação</h3>

    <form method="POST"
          action="{{ url_for('cash.manual_movement') }}"
          style="display:flex; gap:15px; flex-wrap:wrap;">

        <div class="form-group">
            <label>Tipo</label>
            <select name="tipo" required>
                <option value="ENTRADA">Entrada</option>
                <option value="SAIDA">Saída</option>
            </select>
        </div>

        <div class="form-group">
            <label>Valor (R$)</label>
            <input type="number" step="0.01" name="valor" required>
        </div>

        <div class="form-group" style="flex:1;">
            <label>Descrição</label>
            <input type="text" name="descricao" placeholder="Ex: Compra de produtos">
        </div>

        <div class="form-group">
            <button class="btn btn-gold" style="margin-top:22px;">
                Registrar
            </button>
        </div>
    </form>
</div>
{% endif %}

<!-- ============================= -->
<!-- MOVIMENTAÇÕES -->
<!-- ============================= -->
<div class="card">
    <h3>Movimentações do Caixa</h3>

    {% if movimentos %}
    <table class="table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Tipo</th>
                <th>Categoria</th>
                <th>Descrição</th>
                <th>Valor</th>
            </tr>
        </thead>
        <tbody>
            {% for mov in movimentos %}
            <tr>
                <td>{{ mov.criado_em.strftime("%d/%m/%Y %H:%M") }}</td>
                <td>
                    {% if mov.tipo == "ENTRADA" %}
                        <span style="color:#2ecc71;">Entrada</span>
                    {% elif mov.tipo == "SAIDA" %}
                        <span style="color:#ff4d4d;">Saída</span>
                    {% else %}
                        <span style="color:#f1c40f;">Ajuste</span>
                    {% endif %}
                </td>
                <td>{{ mov.categoria or "-" }}</td>
                <td>{{ mov.descricao or "-" }}</td>
                <td>
                    R$ {{ "%.2f"|format(mov.valor) }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p style="color:#9a9a9a;">Nenhuma movimentação registrada.</p>
    {% endif %}
</div>

{% endblock %}
